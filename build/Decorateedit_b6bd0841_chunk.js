(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1522:function(t,e,n){},1738:function(t,e,n){"use strict";n.r(e);n(121);var a=n(45),i=n.n(a),r=(n(1499),n(1500)),o=n.n(r),c=(n(191),n(114)),l=n.n(c),s=(n(82),n(41)),d=n.n(s),u=n(373),p=n.n(u),f=n(3),m=n.n(f),g=(n(88),n(39)),v=n.n(g),h=n(25),y=n.n(h),E=n(20),_=n.n(E),b=n(90),x=n.n(b),O=n(26),w=n.n(O),C=n(22),D=n.n(C),k=n(16),P=n.n(k),S=(n(89),n(40)),R=n.n(S),T=(n(123),n(51)),j=n.n(T),N=n(1),A=n.n(N),I=n(218),X=(n(81),n(18)),z=n.n(X),L=(n(190),n(87)),H=n.n(L),B=n(1722),M=(n(1595),n(122),n(42)),W=n.n(M),V=(n(124),n(64)),F=n.n(V),U=(n(1596),n(1676)),J=n.n(U),K=(n(1495),n(1496)),q=n.n(K),G=(n(73),n(30)),Y=n.n(G),Q=(n(1506),n(1507)),Z=n.n(Q),$=n(219),tt=(n(734),n(377)),et=n.n(tt),nt=n(74),at=n.n(nt),it=n(376),rt=n.n(it),ot=n(24);function ct(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var lt=function(t){w()(n,t);var e=ct(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).componentDidMount=function(){i.props.value&&i.setState({fileList:[{uid:"-1",name:"image.png",status:"done",url:i.props.value}]})},i.handlePreview=function(){var t=rt()(at.a.mark((function t(e){return at.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.url||e.preview){t.next=4;break}return t.next=3,getBase64(e.originFileObj);case 3:e.preview=t.sent;case 4:i.setState({previewImage:e.url||e.preview,previewVisible:!0});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.handleChange=function(t){var e=t.fileList;i.setState({fileList:e});var n={};e.map((function(t){n[i.props.id]=t.response?t.response.resultData:""})),0==e.length&&(n[i.props.id]=""),i.props.uploadchange(n)},i.handleCancel=function(){i.setState({previewVisible:!i.state.previewVisible})},i.state={fileList:[]},i}return _()(n,[{key:"render",value:function(){Object(ot.j)().accessToken;var t=this.state,e=t.previewImage,n=void 0===e?"":e,a=t.fileList,i=t.previewVisible,r={Authorization:"Bearer ".concat(localStorage.getItem("ACCESS_TOKEN"))},o=A.a.createElement("div",null,A.a.createElement(z.a,{type:"plus"}),A.a.createElement("div",{className:"ant-upload-text"},"Upload"));return A.a.createElement("div",null,A.a.createElement(et.a,{action:"https://api.ohhmail.com/api/admin/template_image_upload",listType:"picture-card",headers:r,fileList:a,onPreview:this.handlePreview,onChange:this.handleChange},a.length>=1?null:o),A.a.createElement(j.a,{visible:i,footer:null,onCancel:this.handleCancel},A.a.createElement("img",{alt:"example",style:{width:"100%"},src:n})))}}]),n}(N.Component);lt.defaultProps={},lt.contextType=I.a;var st=lt,dt=function(t){var e=this;this.lodingstatus(!0);var n=t.strhtml,a=t.jsArr,i=t.status,r=void 0===i||i,o=t.id,c=void 0===o?"container":o,l=t.parent_id,s=window.frames.decorate;if(s.document.getElementById(c)||!n){if(r?s.document.getElementById(c)&&(s.document.getElementById(c).innerHTML=n):s.document.getElementById(this.state.footer_id)&&s.document.getElementById(this.state.footer_id).insertAdjacentHTML("beforebegin",n),!a)return window.frames.decorate.loadJs(),void this.lodingstatus(!1);l&&window.frames.decorate.move("-".concat(l)),setTimeout((function(){e.lodingstatus(!1),window.frames.decorate.indata(a)}),3e3)}else this.lodingstatus(!1)},ut=function(t,e){if(t){var n=[];return e?(n.push(t),n):((n=t.split("<script>"))[1]&&(n[1]=n[1].replace("<\/script>",""),n[1]=n[1].replace("</section>","")),n)}},pt={"font-size":"字体大小（PX）",color:"颜色",width:"宽度（PX）",height:"高度（PX）","font-weight":"文字粗细（PX）","background-color":"背景颜色",boder:"线条大小（PX）",margin:"外边距（PX）",padding:"内边距（PX）","padding-left":"左内边距（PX）","padding-right":"右内边距（PX）","padding-top":"上内边距（PX）","padding-bottom":"下内边距（PX）","margin-left":"左外边距（PX）","margin-right":"右外边距（PX）","margin-top":"上外边距（PX）","margin-bottom":"下外边距（PX）","border-radius":"边框弧度（PX）","border-width":"边框大小（PX）","border-color":"边框颜色"},ft=["color","background-color","font-weight","border-color"],mt=function(t,e){var n=e.name_cn;return n+=pt[t]||t},gt=n(731),vt=(n(282),n(223)),ht=n.n(vt),yt=(n(744),n(745)),Et=n.n(yt),_t=n(1598);function bt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var xt=function(t){w()(n,t);var e=bt(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).componentDidMount=function(){},i.getColor=function(t,e){var n=t.hex;i.props.form.setFieldsValue(m()({},e,n)),i.props.changecolor(n,e),i.setState({defaultColoe:n})},i.state={fileList:[]},i}return _()(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.id,a=e.initial,i=this.state.defaultColoe;return A.a.createElement(ht.a,{placement:"topLeft",trigger:"click",content:A.a.createElement("div",{style:{margin:"10px 0"}},A.a.createElement(_t.ChromePicker,{color:i,onChangeComplete:function(e){return t.getColor(e,n)}})," ")},A.a.createElement(Et.a,{style:{width:"20%",fontSize:"12px",height:"28px",lineHeight:"28px",background:i||a}}))}}]),n}(N.Component);xt.defaultProps={},xt.contextType=I.a;var Ot=xt;function wt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Ct(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wt(Object(n),!0).forEach((function(e){m()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var kt=Z.a.Panel,Pt=i.a.Item,St=Y.a.TextArea,Rt=R.a.Option,Tt=function(t){w()(n,t);var e=Dt(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).componentDidMount=function(){var t=i.context.rowData;i.setState({rowData:t})},i.beforeCallback=function(){i.props.form.validateFields((function(t,e){var n=i.context.index,a=i.state.rowData,r=JSON.parse(JSON.stringify(a));function o(t,e){return e&&(t=t.replace(e,"")),t.split("*")}for(var c in e){"boolean"==typeof e[c]&&(e[c]=e[c]?"1":"0");var l=[];if(-1!=c.indexOf("blocks"))if(-1!=c.indexOf("style")){l=o(c,"blocksstyle");var s="";ft.includes(l[0])||(s="px"),r.blocks[l[2]].settings[l[1]].style[l[0]]=(e[c]||"")+s}else l=o(c,"blocks"),r.blocks[l[2]].settings[l[1]].setting_value=e[c]||"";else if(-1!=c.indexOf("name_cn"))r.name_cn=e[c];else if(-1!=c.indexOf("style")){l=o(c,"style");var d="";ft.includes(l[0])||(d="px"),r.settings[l[1]].style[l[0]]=(e[c]||"")+d}else l=o(c),r.settings[l[1]].setting_value=e[c]||""}"total"!=n?(i.context.navdata[n]=r,i.context.customizegupdate({operate:"UPDATE_SECTION",tpl_page_id:i.context.tpl_page_id,tpl_id:i.context.id,section:r,sections:i.context.navdata},r.index),i.context.toggleWin("visible"),i.context.iframeedit(r,n)):gt.a.order.edit_template_global_settings({tpl_id:i.context.id,settings:r.settings}).then((function(t){t&&(i.context.lodingstatus(r.settings,"settingsdata"),v.a.success("保存成功"),window.frames.decorate.loadCss(),i.context.toggleWin("visible"))}))}))},i.uploadchange=function(t){i.props.form.setFieldsValue(Ct({},t))},i.changecolor=function(t,e){i.props.form.setFieldsValue(m()({},e,t)),i.setState({colorvalue:t})},i.fontchange=function(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=t.target.value;document.getElementById(e).style[n]=i+a},i.onChange=function(t){},i.formItme=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",a=i.props.form.getFieldDecorator,r=(i.state.defaultColoe,[]);if(t&&t.length>0){var o=function(t){var e="";if("TEXT"==t.setting_type)e=A.a.createElement(Y.a,null);else if("PICK_IMAGE"==t.setting_type)e=A.a.createElement(st,{uploadchange:this.uploadchange});else if("TEXTAREA"==t.setting_type)e=A.a.createElement(St,null);else if("SELECT"==t.setting_type)e=A.a.createElement(R.a,null,t.options.map((function(t){return A.a.createElement(Rt,{value:t},t)})));else if("SWITCH"==t.setting_type||"CHECKBOX"==t.setting_type)e=A.a.createElement(q.a,{defaultChecked:1==t.setting_value});else if("STYLE"==t.setting_type)e=A.a.createElement("div",null);else if("RANGE"==t.setting_type){var n=t.options||[];e=A.a.createElement(J.a,{min:n[0]||0,max:n[1]||100})}else e="PICK_COLOR"==t.setting_type?A.a.createElement(Y.a,{style:{width:"55%",verticalAlign:"8px"}}):"SELECT_CLASS"==t.setting_type?e=A.a.createElement(R.a,null,t.options.map((function(t){return A.a.createElement(Rt,{value:t.value},A.a.createElement(F.a,{placement:"right",title:A.a.createElement("img",{style:{width:"800px"},src:t.image})},A.a.createElement("p",{style:{marginBottom:"0"}},t.value)))}))):A.a.createElement(Y.a,null);return e};t.map((function(t,c){if(t.style&&t.style!=[])for(var l in t.style){var s="";-1!=t.style[l].indexOf("px")&&(s="number",t.style[l]=t.style[l].replace("px",""));-1!=["border-color","color","background-color"].indexOf(l)?r.push(A.a.createElement(Pt,{label:mt(l,t)},a("".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),{initialValue:t.style[l]||""})(A.a.createElement(Y.a,{style:{width:"55%",verticalAlign:"8px"}}))," ",A.a.createElement(Ot,{id:"".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),changecolor:i.changecolor,form:i.props.form,initial:t.style[l]}))):"font-size"==l?r.push(A.a.createElement(Pt,{label:mt(l,t)},a("".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),{initialValue:t.style[l]})(A.a.createElement(Y.a,{type:"number",style:{width:"55%",verticalAlign:"8px"},onChange:function(t){return i.fontchange(t,"".concat(n,"font"),"fontSize","px")}})),A.a.createElement("span",{id:"".concat(n,"font"),style:{display:"block"}},"测试文字"))):"font-weight"==l?r.push(A.a.createElement(Pt,{label:mt(l,t)},a("".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),{initialValue:t.style[l]})(A.a.createElement(Y.a,{type:"number",style:{width:"55%",verticalAlign:"8px"},onBlur:i.onBlur,onChange:function(t){return i.fontchange(t,"".concat(n,"font"),"fontWeight")}})))):ft.includes(l)?r.push(A.a.createElement(Pt,{label:mt(l,t)},a("".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),{initialValue:t.style[l]})(A.a.createElement(Y.a,{type:s})))):r.push(A.a.createElement(Pt,{label:mt(l,t)},a("".concat(e,"style").concat(l,"*").concat(c,"*").concat(n),{initialValue:t.style[l]})(A.a.createElement(Y.a,{type:"number"}))))}"STYLE"!=t.setting_type&&r.push(A.a.createElement(Pt,{label:t.name_cn},a("".concat(e).concat(t.id,"*").concat(c,"*").concat(n),{initialValue:t.setting_value||""})(o.call(x()(i),t)),"PICK_COLOR"==t.setting_type?A.a.createElement(Ot,{id:"".concat(e).concat(t.id,"*").concat(c,"*").concat(n),changecolor:i.changecolor,form:i.props.form,initial:t.setting_value}):""))}))}return A.a.createElement("div",null,r.map((function(t){return t})))},i.Addcopy=function(){i.context.navdata;var t=i.state.rowData;i.context.iframeadd(t),i.context.toggleWin("visible")},i.addnav=function(){var t=i.state.rowData,e=t.blocks[0];t.blocks.push(e),i.setState({rowData:t})},i.state={fileList:[]},i}return _()(n,[{key:"render",value:function(){var t=this,e=this.context,n=e.visible,a=e.page_type,r=Ct({beforeCallback:this.beforeCallback,title:!1,placement:"left",visible:n,onCancel:function(){return t.context.toggleWin("visible")},width:300,footer:!1,form:this.props.form},this.context.batConfig),o=this.props.form.getFieldDecorator,c=this.state.rowData,l=void 0===c?{}:c,s="PRODUCT_THEME"==a||"INDEX"==a,u=s&&"PHOTO_WALL"!=l.layout&&"PHOTO_WALL_TWO"!=l.layout,p="BANNER"==l.layout,f=function(e){return u||p?A.a.createElement(z.a,{type:"delete",onClick:function(n){1!=l.blocks.length?(l.blocks.splice(e,1),t.setState({rowData:l}),n.stopPropagation()):v.a.error("数据不能为空")}}):""};return A.a.createElement($.DrawerComp,r,A.a.createElement(i.a,null,A.a.createElement("div",{style:{paddingBottom:"135px"}},l.name_cn?A.a.createElement(Pt,{label:"组件名称"},o("name_cn",{initialValue:l.name_cn})(A.a.createElement(Y.a,{disabled:!s}))):"",this.formItme(l.settings,""),l.blocks&&l.blocks.length>0?A.a.createElement("div",null,A.a.createElement(Z.a,null,l.blocks.map((function(e,n){return A.a.createElement(kt,{header:e.name_cn,key:n,extra:f(n)},t.formItme(e.settings,"blocks",n))}))),u||p?A.a.createElement("a",{className:"addsort",onClick:function(){return t.addnav()}},A.a.createElement(z.a,{type:"plus-circle"}),"新增",l.blocks[0].name):""):""),A.a.createElement("div",{className:"drawer-footer"},s?A.a.createElement(H.a,{style:{margin:"10px 0"}},A.a.createElement(W.a,{span:12},A.a.createElement(d.a,{style:{border:"1px solid #4AC8A4",color:"#4AC8A4",width:"100%"},onClick:function(){return t.Addcopy()}}," 复制新增 ")),A.a.createElement(W.a,{span:12},A.a.createElement(d.a,{style:{width:"100%",border:"1px solid #E5859B",color:"#E5859B"},onClick:function(){return t.props.sortcolse()}}," 移除 "))):"",A.a.createElement(d.a,{style:{width:"100%"},type:"primary",onClick:function(){return t.beforeCallback()}}," 应用 "))))}}]),n}(N.Component);Tt.defaultProps={},Tt.contextType=I.a;var jt=i.a.create()(Tt);n(59),n(1522);function Nt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function At(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Nt(Object(n),!0).forEach((function(e){m()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Nt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function It(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var Xt=j.a.confirm,zt=(i.a.Item,R.a.Option,function(t){w()(n,t);var e=It(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).state={categoryStr:[]},i.beforeCallback=function(t,e){i.context.iframeadd(JSON.parse(t.key)),i.onCancel()},i.onCancel=function(){i.props.form.resetFields(),i.context.toggleWin("addvisible",{})},i.additem=function(t){var e=i.context,n=e.tpl_page_id,a={section_id:t,tpl_id:e.tpl_id,tpl_page_id:n},r=x()(i);Xt({content:"是否添加该模板",onOk:function(){r.setState({loading:!0}),gt.a.order.get_template_section_detail(At({},a)).then((function(t){t&&(r.context.iframeadd(t.resultData),r.onCancel())}))},onCancel:function(){}})},i}return _()(n,[{key:"render",value:function(){var t=this,e=(this.props.form.getFieldDecorator,this.context),n=(e.rowData,e.addtemplate),a=void 0===n?[]:n,i=At({wrapClassName:"shop-Modal",beforeCallback:this.beforeCallback,closable:!1,title:!1,footer:!1,visible:this.context.addvisible,onCancel:this.onCancel,form:this.props.form,width:1e3},this.context.batConfig),r=this.state.loading,o=void 0!==r&&r;return A.a.createElement($.ModalComp,i,A.a.createElement(l.a,{spinning:o},A.a.createElement("div",{className:"decora-add-main"},a.map((function(e){return 0==e.blocks.length?A.a.createElement("div",{className:"decora-add-item",onClick:function(){return t.additem(e.id)}},A.a.createElement("img",{src:e.image}),A.a.createElement("p",null,e.name)):e.blocks.map((function(e){return A.a.createElement("div",{className:"decora-add-item",onClick:function(){return t.additem(e.id)}},A.a.createElement("img",{src:e.image}),A.a.createElement("p",null,e.name))}))})))))}}]),n}(N.Component));zt.defaultProps={},zt.contextType=I.a;var Lt=i.a.create()(zt);function Ht(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var Bt=j.a.confirm,Mt=Object(B.b)((function(t){var e=t.item,n=t._index,a=t.sortreset,i=t.sortedit,r=t.page_type;return A.a.createElement("p",{className:"commer"},A.a.createElement("span",{className:"commer-title"},e.name_cn),"HEADER"!=r&&"HEADER"==e.layout||"FOOTER"!=r&&"FOOTER"==e.layout?"":A.a.createElement("span",null,A.a.createElement("a",{onClick:function(){return i(e,n)},style:{marginRight:"10px",pointerEvents:"initial"}},"编辑"),A.a.createElement("a",{style:{color:"#f43c3c",pointerEvents:"initial"},onClick:function(){return a(e,n)}},"重置")))})),Wt=Object(B.a)((function(t){var e=t.items,n=t.sortreset,a=t.sortedit,i=t.page_type;return A.a.createElement(H.a,null,e.map((function(t,e){return A.a.createElement(Mt,{index:e,page_type:i,key:"-".concat(e),_index:e,sortreset:n,sortedit:a,item:t})})))})),Vt=function(t){w()(n,t);var e=Ht(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).componentDidMount=function(){},i.sortedit=function(t,e){i.context.toggleWin("visible",t,e),window.frames.decorate.move("-".concat(t.index))},i.editsetting=function(){var t={settings:i.context.settingsdata};i.context.toggleWin("visible",t,"total")},i.sortreset=function(t,e){var n=i.context,a=n.navdata,r=n.customizegupdate,o=n.tpl_page_id,c=n.id,l="";l=t.index?"index":"id";for(var s=Object(ot.g)("init_data"),d=i.props.sortEnd,u=0;u<s.length;u++)t[l]==s[u][l]&&(a[e]=s[u]);var p=a[e];Bt({content:"是否重置该模块",onOk:function(){d(a),r({operate:"UPDATE_SECTION",tpl_page_id:o,tpl_id:c,section:p,sections:a},p.index)},onCancel:function(){}})},i.sortcolse=function(){var t=i.context,e=t.rowData,n=t.index,a=t.toggleWin,r=t.customizegupdate,o=t.tpl_page_id,c=t.id,l=i.props,s=l.navdata,d=l.sortEnd;-1==["FOOTER","HEADER"].indexOf(s[n].layout)?Bt({content:"是否删除该模块",onOk:function(){a("visible"),s.splice(n,1),d(s);var t=window.frames.decorate.document.getElementById("-".concat(e.index));t.parentNode.removeChild(t),r({operate:"DELETE_SECTION",tpl_page_id:o,tpl_id:c,section:{},sections:s})},onCancel:function(){}}):v.a.error("特殊模块不允许删除")},i.onSortEnd=function(t){var e=t.oldIndex,n=t.newIndex,a=i.props,r=a.navdata,o=a.sortEnd,c=i.context.page_type;if("PRODUCT_THEME"==c||"INDEX"==c){var l=["FOOTER","HEADER"];if(-1==l.indexOf(r[n].layout)&&-1==l.indexOf(r[e].layout)){i.context.lodingstatus(!0);var s=JSON.parse(JSON.stringify(r)),d=s[e],u=s[n];s[e]=u,s[n]=d,i.context.customizegupdate({operate:"UPDATE_SECTION",tpl_page_id:i.context.tpl_page_id,tpl_id:i.context.id,section:{},sections:s}),window.frames.decorate.sp(r[e].index,r[n].index,e,n),window.frames.decorate.move("-".concat(r[e].index)),o(s)}else v.a.error("头部底部不允许修改位置")}},i.addnav=function(){i.context.toggleWin("addvisible")},i.state={},i}return _()(n,[{key:"render",value:function(){var t=this;p()(this.state);var e=this.props,n=e.changename,a=e.navdata,i=void 0===a?[]:a,r=this.context.page_type;return A.a.createElement("div",{className:"sort-main",id:"sort_main"},A.a.createElement("div",{className:"sort-header"},A.a.createElement("p",null,n)),A.a.createElement("div",{className:"PRODUCT_THEME"==r||"INDEX"==r?"sort-item":"sort-item sort-none"},A.a.createElement(Wt,{items:i,sortreset:this.sortreset,sortedit:this.sortedit,page_type:r,onSortEnd:function(e){return t.onSortEnd(e)},axis:"xy",distance:"10"}),"PRODUCT_THEME"==r||"INDEX"==r?A.a.createElement("a",{className:"addsort",onClick:function(){return t.addnav()}},A.a.createElement(z.a,{type:"plus-circle"}),"新增模块"):""),A.a.createElement(z.a,{type:"setting",className:"sort-setting",onClick:function(){return t.editsetting()}}),this.context.visible&&A.a.createElement(jt,{sortcolse:this.sortcolse}),this.context.addvisible&&A.a.createElement(Lt,null))}}]),n}(A.a.Component);Vt.contextType=I.a;var Ft=i.a.create()(Vt);function Ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ut(Object(n),!0).forEach((function(e){m()(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=P()(t);if(e){var i=P()(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return D()(this,n)}}var qt=j.a.confirm,Gt=R.a.Option,Yt=function(t){w()(n,t);var e=Kt(n);function n(t,a){var i;return y()(this,n),(i=e.call(this,t,a)).componentDidMount=function(){var t=i.props.routeParams,e=t.id,n=t.tpl_id;i.id=n,i.tpl_page_id=e,Object(ot.p)("init_data",[]),i.customizegpages_list(n,e),i.customizetemplate(e,n,!0),gt.a.order.customizegsections({tpl_id:n,tpl_page_id:e}).then((function(t){t&&i.setState({addtemplate:t.resultData})})),gt.a.order.get_template_global_settings({tpl_id:n}).then((function(t){t&&i.setState({settingsdata:t.resultData})})),i.setState({navheight:document.documentElement.clientHeight-60})},i.customizegpages_list=function(t,e){var n=i.tpl_page_id;gt.a.order.customizegpages_list({tpl_id:t,tpl_page_id:n}).then((function(t){t&&i.setState({selecttemplate:t.resultData})}))},i.preview=function(){var t=i.state,e=t.previewtext,n=t.previewshow;i.setState({previewtext:"预览"==e?"退出预览":"预览",previewshow:!n})},i.iframonload=function(){var t=i.state,e=t.navdata,n=void 0===e?[]:e,a=t.page_type,r=t.page_html,o=void 0===r?"":r,c="",l="";"PRODUCT_THEME"==a||"INDEX"==a?n.map((function(t,e){if(t.index=e,t.html){var n=ut(t.html);n[1]&&(c+=n[1]),l+='<div id="-'.concat(e,'" class="h-edit-item">').concat(n[0],"</div>")}})):o&&(l='<div id="-'.concat(0,"HEADER"==a?'" class="h-edit-item d-h-item ">':'" class="h-edit-item ">',o,"</div>")),l&&dt.call(x()(i),{strhtml:l,jsArr:c}),Object(ot.p)("init_data",n),i.setState({navdata:n})},i.iframeadd=function(t){var e=i.state,n=e.navdata,a=void 0===n?[]:n,r=(e.changeselect,e.tpl_page_id),o=Object(ot.g)("init_data");t.index=o.length,a.splice(a.length-1,0,t),o.splice(o.length-1,0,t),Object(ot.p)("init_data",o),i.customizegupdate({operate:"ADD_SECTION",tpl_page_id:r,tpl_id:i.id,section:t,sections:a}),i.setState({navdata:a},(function(){var e=o.length-1,n=ut(t.html),a=t.html;n&&n[0]&&(a=n[0]);var r='<div id="-'.concat(e,'" class="h-edit-item">').concat(a,"</div>");dt.call(x()(i),{strhtml:r,jsArr:n&&n[1]||"",status:!1,parent_id:e})}))},i.iframeedit=function(t,e){var n=i.state,a=n.navdata,r=void 0===a?[]:a,o=(n.changeselect,n.page_type);n.page_html;"PRODUCT_THEME"==o||"INDEX"==o?(r[e]=t,i.setState({navdata:r},(function(){}))):(i.lodingstatus(!0),setTimeout((function(){window.frames.decorate.loadJs(),i.lodingstatus(!1)}),2e3))},i.Publish=function(){var t=x()(i),e=i.id;qt({content:"是否发布该模板",onOk:function(){gt.a.order.customizepublish({tpl_id:e}).then((function(e){v.a.success("发布成功"),t.props.goBack()}))},onCancel:function(){}})},i.quit=function(){var t=x()(i);qt({content:"是否退出,未保存修改将会清除",onOk:function(){t.props.goBack()},onCancel:function(){}})},i.sortEnd=function(t){i.setState({navdata:t},(function(){i.lodingstatus(!1)}))},i.toggleWin=function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"visible",n=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,r={rowData:n,index:a};i.setState((t={},m()(t,e,!i.state[e]),m()(t,"otherConfig",r),t))},i.lodingstatus=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"loading";i.setState(m()({},e,t))},i.customizegupdate=function(t,e){var n=i.state.page_type,a="PRODUCT_THEME"!=n&&"INDEX"!=n,r=Jt({},t);i.draft_id&&(r.draft_id=i.draft_id),a&&(e=0),gt.a.order.customizegupdate(Jt({},r)).then((function(t){if(t&&(i.draft_id=t.resultData.draft_id,t.resultData.html)){var n=ut(t.resultData.html,a),r="".concat(n[0]);dt.call(x()(i),{id:"-".concat(e),strhtml:r,jsArr:n[1]||""})}}))},i.state={visible:!1,addvisible:!1,changeselect:"",navdata:[],init_data:[],previewtext:"预览",previewshow:!0},i.id="",i.draft_id="",i.tpl_page_id="",i}return _()(n,[{key:"customizetemplate",value:function(t,e,n){var a=this;gt.a.order.customizetemplate({tpl_page_id:t,tpl_id:e}).then((function(t){t&&(a.setState({navdata:t.resultData.sections,changeselect:"".concat(t.resultData.id,"-").concat(t.resultData.tpl_id),tpl_page_id:t.resultData.id,changename:t.resultData.name_cn,page_type:t.resultData.page_type,page_html:t.resultData.html,is_mobile:t.resultData.is_mobile},(function(){n||a.iframonload(),a.setState({footer_id:"-".concat(t.resultData.sections.length-1)})})),0==t.resultData.sections.length&&a.setState({loading:!1}))}))}},{key:"handleChange",value:function(t){var e=this.state.selecttemplate,n="",a=t.split("-"),i=this;qt({content:"确定切换模块，离开后未保存选项将不会保存",onOk:function(){for(var r=0;r<e.length;r++)if(e[r].id==a[0]){n=e[r].name_cn;break}i.setState({changeselect:t,tpl_id:a[1],tpl_page_id:a[0],changename:n,loading:!0}),gt.a.order.customizegsections({tpl_id:a[1],tpl_page_id:a[0]}).then((function(t){t&&i.setState({addtemplate:t.resultData})})),i.customizegpages_list(a[1],a[0]),i.customizetemplate(a[0],a[1])},onCancel:function(){}})}},{key:"save",value:function(){if(this.draft_id){var t={tpl_page_id:this.state.tpl_page_id,draft_id:this.draft_id,tpl_id:this.id},e=this;qt({content:"是否保存该模板",onOk:function(){gt.a.order.customizegsave(Jt({},t)).then((function(t){t&&(e.draft_id="",v.a.success("保存成功"))}))},onCancel:function(){}})}else v.a.error("请修改模板在保存")}},{key:"render",value:function(){var t,e=this,n=this.state,a=n.init_data,i=void 0===a?[]:a,r=n.changeselect,c=n.navdata,s=void 0===c?[]:c,u=n.navheight,f=n.visible,g=n.addvisible,v=(n.previewtext,n.previewshow),h=n.addtemplate,y=void 0===h?[]:h,E=n.selecttemplate,_=void 0===E?[]:E,b=n.changename,x=n.loading,O=void 0===x||x,w=n.tpl_page_id,C=n.tpl_id,D=n.page_type,k=n.settingsdata,P=n.is_mobile,S=void 0===P?0:P;p()(this.props.form);var T=Jt(Jt({settingsdata:k,init_data:i,navdata:s,changeselect:r,toggleWin:this.toggleWin,visible:f,addvisible:g,addtemplate:y,iframeadd:this.iframeadd,iframeedit:this.iframeedit,id:this.id,draft_id:this.draft_id,customizegupdate:this.customizegupdate},this.state.otherConfig),{},{tpl_page_id:w,tpl_id:C,page_type:D,lodingstatus:this.lodingstatus}),j=0==S?"/Decorate/index.html":"/Decorate/index-mobile.html";return A.a.createElement("div",{className:"decorate-main"},A.a.createElement("div",{className:"header-tool"},A.a.createElement("p",null,"模板编辑"),A.a.createElement("div",null,A.a.createElement(d.a,{type:"primary",onClick:function(){return e.save()}},"保存"),A.a.createElement(d.a,{type:"primary",onClick:function(){return e.Publish()}},"发布"),A.a.createElement(d.a,(t={type:"primary"},m()(t,"type","danger"),m()(t,"onClick",(function(){return e.quit()})),t),"退出"))),A.a.createElement("a",{id:"iframonload",onClick:function(){return e.iframonload()}}),A.a.createElement(I.a.Provider,{value:T},A.a.createElement("div",{className:"decorate-conce"},A.a.createElement("div",{className:"d-c-l-main"},A.a.createElement(o.a,{offsetTop:60},A.a.createElement(l.a,{spinning:O},v?A.a.createElement("div",{className:"d-c-le",style:{height:u}},A.a.createElement(Ft,{changename:b,sortEnd:this.sortEnd,navdata:s})):""))),A.a.createElement("div",{className:"d-c-r-main"},A.a.createElement("div",{className:"nav-main"},A.a.createElement("span",null,"请选择您要编辑的页面:  "),A.a.createElement(R.a,{value:r,onChange:function(t){return e.handleChange(t)},style:{width:"100px",marginRight:"10px"}},_.map((function(t){return A.a.createElement(Gt,{value:"".concat(t.id,"-").concat(t.tpl_id)},t.name_cn)})))),A.a.createElement("div",{className:"d-c-ri",id:"iframe"},A.a.createElement(l.a,{spinning:O,style:{display:"flex",justifyContent:"center"}},s.length>0?A.a.createElement("iframe",{name:"decorate",src:j,style:{width:0==S?"null":"375px"}}):""))))))}}]),n}(A.a.Component);e.default=i.a.create()(Yt)}}]);