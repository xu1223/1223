(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{1592:function(e,t,a){},1725:function(e,t,a){"use strict";a.r(t);a(82);var n=a(41),i=a.n(n),s=(a(281),a(113)),r=a.n(s),l=(a(73),a(30)),o=a.n(l),c=a(28),u=a.n(c),m=(a(88),a(39)),p=a.n(m),d=a(25),f=a.n(d),h=a(20),g=a.n(h),b=a(26),v=a.n(b),_=a(22),y=a.n(_),E=a(16),D=a.n(E),w=(a(121),a(45)),k=a.n(w),x=(a(89),a(40)),S=a.n(x),C=a(1),T=a.n(C),O=(a(218),a(59)),F=a(10),N=a(55),I=a(1498);a(1592);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=D()(e);if(t){var i=D()(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return y()(this,a)}}var R=S.a.Option,J=k.a.Item,P=function(e){v()(a,e);var t=j(a);function a(e,n){var i;f()(this,a),(i=t.call(this,e,n)).handleSubmit=function(e){e.preventDefault(),i.props.form.validateFields((function(e,t){if(!e){var a={title:t.title,to_email:JSON.stringify(i.state.emaildata),send_email:t.send_email?1:0};"check"==i.operType?a.draft_id=i.id:a.message_id=0==i.id?"":i.id,a.content=UE.getEditor("wapcontainer1")?UE.getEditor("wapcontainer1").getContent():"",a.content=a.content,Object(F.b)(N.a.save_message,a).then((function(e){e&&e.resultId&&(p.a.success(e.resultMsg),i.closePage())}))}}))},i.drafts=function(e){i.props.form.validateFields((function(e,t){if(!e){var a={title:t.title,to_email:JSON.stringify(i.state.emaildata),send_email:t.send_email?1:0};"check"==i.operType&&(a.draft_id=i.id),a.content=UE.getEditor("wapcontainer1")?UE.getEditor("wapcontainer1").getContent():"",a.content=a.content,Object(F.b)(N.a.save_message_draft,a).then((function(e){e&&e.resultId&&(p.a.success(e.resultMsg),i.closePage())}))}}))},i.shopclose=function(){i.props.router.goBack()},i.handleChange=function(e){e.length>5&&Object(F.b)(N.a.get_customer_list,{email:e}).then((function(e){i.setState({customer_list:e.resultData})}))},i.onChange=function(e,t){var a=[];e.map((function(e,n){i.state.emaildata.map((function(i){e==i.email&&(a.push(i),delete t[n])}))})),t.map((function(e){a.push({customer_id:e.props.value,email:e.props.children})})),i.setState({emaildata:a})},i.closePage=function(){i.props.router.goBack()},i.state={rowData:{},text:"",customer_list:[],emailid:[],emaildata:[]};var s=e.params,r=s.type,l=s.id;return i.operType=r,i.id="0"==l?parseInt(l):l,i}return g()(a,[{key:"componentDidMount",value:function(){var e=this;"edit"==this.operType?Object(F.b)(N.a.get_message,{id:this.id}).then((function(t){if(200==t.resultId){var a=t.resultData,n='<p>\n                    &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>\n                 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br/>\n                 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;\n                </p>\n                <p>\n                    ------------ Last message ------------\n                </p>\n                <div style="font-size: 12px;background:#efefef;padding:8px;">\n                    <div style="padding:10px">\n                        <strong>From ： </strong> ('.concat(a.from_email,')\n                    </div>\n                    <div style="padding:10px">\n                        <strong>Time ：</strong> ').concat(a.created_at,'\n                    </div>\n                    <div style="padding:10px">\n                        <strong>Title ：</strong>').concat(a.title,'\n                    </div>\n                </div>\n                <div>\n                    <br/>\n                </div>\n                <div style="padding:10px">\n                    ').concat(a.content,"\n                </div>\n                \n                Last message\n                <p>\n                ------------ Last message ------------\n               </p>\n\n                "),i=[];t.resultData.to_emails&&t.resultData.to_emails.length>0&&t.resultData.to_emails.map((function(e){i.push(e.email)})),e.setState({emailid:t.resultData.from_email?t.resultData.from_email:i,text:n,rowData:t.resultData,emaildata:[{customer_id:t.resultData.customer_id,email:t.resultData.from_email}]})}})):"check"==this.operType&&Object(F.b)(N.a.get_draft_message,{draft_id:this.id}).then((function(t){if(200==t.resultId){var a=[];t.resultData.to_emails.map((function(t){e.state.emaildata.push({customer_id:t.customer_id,email:t.email}),a.push(t.email)})),e.setState({emailid:a,rowData:t.resultData,text:t.resultData.content})}}))}},{key:"render",value:function(){var e=this,t=this.state,a=t.rowData,n=t.emailid,s=t.text,l=t.customer_list,c=this.props.form.getFieldDecorator;return T.a.createElement("div",{className:"main"},T.a.createElement(k.a,{onSubmit:this.handleSubmit},T.a.createElement(J,u()({label:"会员邮箱"},O.f),c("to_email",{initialValue:n||[],rules:[{required:!0,message:"请输入会员邮箱，最少输入5位"}]})(T.a.createElement(S.a,{mode:"multiple",placeholder:"请输入会员邮箱，最少输入5位",onSearch:this.handleChange,onChange:this.onChange,style:{width:"100%"}},l.map((function(e){return T.a.createElement(R,{key:e.id,value:e.id},e.email)}))))),T.a.createElement(J,u()({label:"主题"},O.f),c("title",{initialValue:a.title?a.title:"",rules:[{required:!0,message:"请输入主题"}]})(T.a.createElement(o.a,null))),T.a.createElement(J,u()({label:"内容"},O.f),c("tag_ids",{})(T.a.createElement("div",null,T.a.createElement(I.a,{initialFrameHeight:300,id:"wapcontainer1",richText:s})))),T.a.createElement(J,u()({label:""},O.f),c("send_email",{})(T.a.createElement(r.a,{value:"1"},"是否同时发送邮件"))),T.a.createElement("div",{className:"shop-footer-btn"},T.a.createElement("div",null,T.a.createElement(i.a,{type:"primary",htmlType:"submit",className:"saveForm"},"发送"),T.a.createElement(i.a,{type:"primary",onClick:this.drafts,className:"saveForm"},"存草稿箱"),T.a.createElement(i.a,{htmlType:"button",onClick:function(){return e.shopclose()},className:"close"},"关闭")))))}}]),a}(C.Component);t.default=k.a.create()(P)}}]);