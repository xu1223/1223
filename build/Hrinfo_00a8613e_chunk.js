(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1751:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return we}));n(1491);var r,a,i,o=n(1492),c=n.n(o),l=(n(1495),n(1496)),s=n.n(l),u=n(3),f=n.n(u),d=(n(88),n(39)),p=n.n(d),h=n(74),m=n.n(h),g=n(376),v=n.n(g),b=n(25),y=n.n(b),O=n(20),D=n.n(O),w=n(26),E=n.n(w),C=n(22),P=n.n(C),j=n(16),x=n.n(j),_=n(1),k=n.n(_),S=n(69),R=n.n(S),A=(n(121),n(45)),N=n.n(A),I=n(1494),T=n(5),Y=n.n(T);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x()(e);if(t){var a=x()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return P()(this,n)}}var V=(a=r=N.a.create()(i=function(e){E()(n,e);var t=W(n);function n(e,r){var a;return y()(this,n),(a=t.call(this,e,r)).state={},a.getTime=function(e){var t=R()(e,2),n=t[0],r=t[1];return{start_time:n=new Date(Y()(n).format("YYYY-MM-DD")+" 0:00:00").getTime()/1e3,end_time:r=new Date(Y()(r).format("YYYY-MM-DD")+" 23:59:59").getTime()/1e3}},a.handleFormData=function(e){var t=e.devtime,n=void 0===t?[]:t,r={};r=n.length>0?M({},a.getTime(n)):{start_time:"",end_time:""},a.props.changeSearch(M(M({},e),r))},a}return D()(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=[{type:"input",labelConf:{name:"角色名称",key:"name"},span:6},{labelConf:{name:"状态",key:"status"},span:6,data:[{name:"全部",id:""},{name:"启用",id:"1"},{name:"禁用",id:"2"}]}];return k.a.createElement(I.a,{loading:this.props.loading,SearchConf:e,form:this.props.form,handleFormData:this.handleFormData})}}]),n}(_.Component))||i,r.defaultProps={},a),z=(n(190),n(87)),F=n.n(z),q=n(1489),J=(n(122),n(42)),H=n.n(J),B=n(28),G=n.n(B),K=(n(73),n(30)),Q=n.n(K),U=(n(81),n(18)),X=n.n(U),Z=(n(735),n(379)),$=n.n(Z),ee=n(731),te=n(59),ne=n(219),re=n(218);n(67);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x()(e);if(t){var a=x()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return P()(this,n)}}var ce=$.a.TreeNode,le=N.a.Item,se=function(e){E()(n,e);var t=oe(n);function n(e,r){var a;return y()(this,n),(a=t.call(this,e,r)).state={previewVisible:!1,previewImage:"",fileList:[],rolesDataArr:a.context.rolesDataArr||[]},a.beforeCallback=function(e,t){var n=a.context.rowData,r=void 0===n?{}:n,i=a.state.Allids,o=void 0===i?[]:i,c="";r.id?(c="edit_role",e.id=r.id):c="add_role",0==o.length&&p.a.error("请选择权限"),e.status=e.status?1:2,e.menu_ids=o.toString(),ee.a.order[c](ie({},e)).then((function(e){e&&(a.context.toggleWin(),p.a.success("修改成功"),a.context.changeSearch())}))},a.renderTreeNodes=function(e){var t=[];return e.map((function(e){var n="".concat(e.id,"##").concat(e.parent_id);Array.isArray(e.children)&&e.children.length>0?t.push(k.a.createElement(ce,{value:n,title:e.name,key:e.id,dataRef:e},a.renderTreeNodes(e.children))):t.push(k.a.createElement(ce,{value:n,title:e.name,isLeaf:e.isLeaf,key:e.id,dataRef:e}))})),t},a.mapfilter=function(e){var t=[];return e.map((function(e){var n=e.split("##");t.push(n[1]),t.push(n[0])})),t.filter((function(e,n,r){return t.indexOf(e,0)===n}))},a.onChange=function(e,t,n){a.setState({Allids:a.mapfilter(e)})},a.menu_ids=[],a}return D()(n,[{key:"componentDidMount",value:function(){var e=this,t=this.context.rowData;this.menu_ids=[];var n=[];t.menus&&t.menus.length>0&&t.menus.map((function(t){n.push(t.id),e.menu_ids.push("".concat(t.id,"##").concat(t.parent_id))})),this.setState({Allids:n})}},{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator,n=this.context,r=n.rowData,a=void 0===r?{}:r,i=n.ProductCategoryDataList,o=void 0===i?[]:i,c=0==Object.keys(a).length,l=ie({beforeCallback:this.beforeCallback,title:k.a.createElement("span",null,k.a.createElement(X.a,{type:c?"diff":"edit",style:{color:"#798994",marginRight:10}}),c?"新增角色":"编辑角色"),visible:this.context.visible,onCancel:function(){return e.context.toggleWin()},form:this.props.form},this.context.batConfig);return k.a.createElement(ne.DrawerComp,l,k.a.createElement(N.a,{className:"bulletbox-form"},k.a.createElement(F.a,{type:"flex",justify:"space-between",align:"middle"},k.a.createElement(H.a,{span:24},k.a.createElement(le,G()({label:"角色名称"},te.b),t("name",{initialValue:a.name||"",rules:[{required:!0,message:"必填项"}]})(k.a.createElement(Q.a,null)))),k.a.createElement(H.a,{span:24},k.a.createElement(le,G()({label:"角色描述"},te.b),t("memo",{initialValue:a.memo||"",rules:[{required:!0,message:"必填项"}]})(k.a.createElement(Q.a,null)))),k.a.createElement(H.a,{span:24},k.a.createElement(le,G()({label:"是否启用"},te.b),t("status",{initialValue:"1"==a.status,valuePropName:"checked"})(k.a.createElement(s.a,{checkedChildren:"启用",unCheckedChildren:"禁用"})))),k.a.createElement(H.a,{span:24},k.a.createElement(le,G()({label:"选择权限"},te.b),t("menu_ids",{initialValue:this.menu_ids})(k.a.createElement($.a,{showSearch:!0,style:{width:"100%"},dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"Please select",treeCheckable:!0,allowClear:!0,multiple:!0,treeDefaultExpandAll:!0,onChange:this.onChange},this.renderTreeNodes(o))))))))}}]),n}(_.Component);se.defaultProps={},se.contextType=re.a;var ue=N.a.create()(se),fe=n(55);function de(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x()(e);if(t){var a=x()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return P()(this,n)}}var pe=function(e){E()(n,e);var t=de(n);function n(e,r){var a;return y()(this,n),(a=t.call(this,e,r)).state={},a}return D()(n,[{key:"render",value:function(){var e=this,t={config:[{title:"添加",noAuth:"add",noCheck:!0,onClick:function(){return e.context.toggleWin("visible",{rowData:{}})}},{title:"批量编辑",noAuth:"del",method:fe.a.batch_edit_role,unicode:"ids|id"}],method:fe.a.user_manager_batch,unicode:"ids|id",batConfig:this.context.batConfig};return k.a.createElement("div",{className:"action-bar"},k.a.createElement(F.a,{type:"flex",justify:"space-between",align:"middle",gutter:10},k.a.createElement(q.a,t)),this.context.visible&&k.a.createElement(ue,null))}}]),n}(_.Component);pe.defaultProps={},pe.contextType=re.a;var he,me,ge,ve=n(1493),be=n(1490);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){f()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=x()(e);if(t){var a=x()(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return P()(this,n)}}var we=(me=he=Object(be.a)({toolConfig:{list:{action:"get_role_list_pager",params:{}}}})(ge=function(e){E()(n,e);var t=De(n);function n(e,r){var a;return y()(this,n),(a=t.call(this,e,r)).state={},a.componentDidMount=v()(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.props.changeSearch({pagesize:"20"}),ee.a.order.get_menu_list_pager({page_size:"1000"}).then((function(e){e&&a.setState({ProductCategoryDataList:e.resultData.data})}));case 2:case"end":return e.stop()}}),e)}))),a.switchChange=function(e,t){var n=e?"1":"2";ee.a.order.edit_role({id:t.id,status:n}).then((function(e){e&&(p.a.success("修改成功"),a.props.changeSearch())}))},a.toggleWin=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"visible",n=arguments.length>1?arguments[1]:void 0;a.setState((e={},f()(e,t,!a.state[t]),f()(e,"otherConfig",n),e))},a._batProps=function(e){return{config:[{title:"编辑",noAuth:"edit",noCheck:!0,size:"small",ghost:!0,onClick:function(){return a.toggleWin("visible",{rowData:e})}},{title:"删除",noAuth:"delete",method:fe.a.delete_member,size:"small",ghost:!0,params:{ids:e.id},type:"danger"}],batConfig:a.props.batConfig,rowData:e}},a.columns=[{title:"角色名称",dataIndex:"name"},{title:"角色描述",dataIndex:"memo"},{title:"使用人数",dataIndex:"members",render:function(e,t){var n="";return e&&(n=e.length),k.a.createElement("span",null,n)}},{title:"创建者",dataIndex:"id",render:function(e,t){return k.a.createElement("span",null,"管理员")}},{title:"创建时间",dataIndex:"created_at"},{title:"修改时间",dataIndex:"updated_at"},{title:"状态",dataIndex:"is_rec",render:function(e,t){return k.a.createElement("span",null,k.a.createElement(s.a,{checked:"1"==t.status,onChange:function(e){return a.switchChange(e,t)}}))}},{title:"操作",dataIndex:"key",render:function(e,t,n){return k.a.createElement(q.a,a._batProps(t))}}],a}return D()(n,[{key:"render",value:function(){var e=this.state,t=e.groupsDataArr,n=void 0===t?[]:t,r=e.rolesDataArr,a=void 0===r?[]:r,i=e.ProductCategoryDataList,o=void 0===i?[]:i,l=Oe({columns:this.columns},this.props.tableConfig),s=Oe(Oe({changeSearch:this.props.changeSearch,visible:this.state.visible,visibleg:this.state.visibleg},this.state.otherConfig),{},{toggleWin:this.toggleWin,batConfig:this.props.batConfig,rolesDataArr:a,groupsDataArr:n,ProductCategoryDataList:o});return k.a.createElement("div",{className:"userStyle"},k.a.createElement(re.a.Provider,{value:s},k.a.createElement(V,{changeSearch:this.props.changeSearch,groupsDataArr:n}),k.a.createElement("div",{className:"header-tool"},k.a.createElement("p",null,"角色管理"),k.a.createElement(pe,null)),k.a.createElement(c.a,{className:"content-main"},k.a.createElement("div",{className:"content-table"},k.a.createElement(ve.a,l)))))}}]),n}(_.Component))||ge,he.defaultProps={},me)}}]);